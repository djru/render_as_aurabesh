<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Aurebesh Live Render</title>
        <style>
            @font-face {
                font-family: "Aurabesh";
                /* The ?v=1 trick forces Chrome to reload the file fresh */
                src: url("AurebeshBold-Rw1l.ttf?v=1") format("truetype");
                font-display: swap;
                font-weight: normal;
                font-style: normal;
            }

            .custom-text {
                font-family: "Aurabesh", sans-serif;
                font-size: 3rem;
                color: #000000;
                line-height: 1.2;
            }

            body {
                font-family: -apple-system, system-ui, sans-serif;
                background-color: #ffffff;
                color: #000;
                margin: 0;
                padding: 20px;
                display: flex;
                flex-direction: column;
                align-items: center;
            }

            .container {
                width: 100%;
                max-width: 500px;
                display: flex;
                flex-direction: column;
                gap: 15px;
            }

            textarea {
                width: 100%;
                height: 80px;
                padding: 12px;
                box-sizing: border-box;
                font-size: 16px;
                outline: none;
            }

            .instruction {
                font-size: 12px;
                color: #666;
                text-align: center;
                margin-bottom: 5px;
            }

            /* The canvas is now visible and styled to look like a UI element */
            #renderCanvas {
                width: 100%;
                height: auto;
                border: 2px solid #eee;
                border-radius: 12px;
                background-color: #fff;
                display: block;
                touch-action: manipulation;
            }

            .hidden-font-trigger {
                font-family: "Aurabesh";
                visibility: hidden;
                position: absolute;
                height: 0;
            }
        </style>
    </head>
    <body>
        <div class="hidden-font-trigger">Loading Font...</div>

        <div class="container">
            <textarea
                id="textInput"
                placeholder="Type Star Wars text..."
            ></textarea>

            <p class="instruction">
                Long-press the image below to save or share
            </p>

            <canvas id="renderCanvas"></canvas>
        </div>

        <script>
            const input = document.getElementById("textInput");
            const canvas = document.getElementById("renderCanvas");
            const ctx = canvas.getContext("2d");

            // Initial setup
            window.onload = () => {
                // Wait for font to be ready before first render
                document.fonts.ready.then(() => {
                    draw();
                });
            };

            input.addEventListener("input", draw);

            function draw() {
                const text = input.value || "Type Something";
                const lines = text.split("\n");
                const fontSize = 70;
                const padding = 60;

                // 1. Temporary measure to find width
                ctx.font = `${fontSize}px aurabesh`;
                let maxW = 0;
                lines.forEach((line) => {
                    const metrics = ctx.measureText(line);
                    if (metrics.width > maxW) maxW = metrics.width;
                });

                // 2. Resize canvas to fit content perfectly
                // We use a high-resolution multiplier for crisp text on iPhone
                const scale = 2;
                canvas.width = (maxW + padding * 2) * scale;
                canvas.height =
                    (lines.length * fontSize * 1.2 + padding * 2) * scale;

                // Scale context so we can use normal coordinates
                ctx.scale(scale, scale);

                // 3. Background
                ctx.fillStyle = "#ffffff";
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // 4. Text
                ctx.fillStyle = "#000000";
                ctx.font = `${fontSize}px aurabesh`;
                ctx.textAlign = "center";
                ctx.textBaseline = "top";

                lines.forEach((line, i) => {
                    ctx.fillText(
                        line,
                        (maxW + padding * 2) / 2,
                        padding + i * fontSize * 1.2,
                    );
                });
            }
        </script>
    </body>
</html>
